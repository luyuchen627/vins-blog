<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>层叠图层堆积 | vins blog</title>
    <meta name="description" content="vins-blog">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.522f73f5.css" as="style"><link rel="preload" href="/assets/js/app.4d681007.js" as="script"><link rel="preload" href="/assets/js/73.e899a1fb.js" as="script"><link rel="prefetch" href="/assets/js/10.6c92f68c.js"><link rel="prefetch" href="/assets/js/100.8af1db53.js"><link rel="prefetch" href="/assets/js/101.a8f212fb.js"><link rel="prefetch" href="/assets/js/102.271e20bf.js"><link rel="prefetch" href="/assets/js/103.4dbd4c71.js"><link rel="prefetch" href="/assets/js/104.394031f5.js"><link rel="prefetch" href="/assets/js/105.eaeab38e.js"><link rel="prefetch" href="/assets/js/106.07ccd110.js"><link rel="prefetch" href="/assets/js/107.eb46ec7e.js"><link rel="prefetch" href="/assets/js/108.5c90f70d.js"><link rel="prefetch" href="/assets/js/109.cd44b569.js"><link rel="prefetch" href="/assets/js/11.1c0e0af2.js"><link rel="prefetch" href="/assets/js/110.a57066cd.js"><link rel="prefetch" href="/assets/js/111.252e8880.js"><link rel="prefetch" href="/assets/js/112.193f8246.js"><link rel="prefetch" href="/assets/js/113.9c4918c3.js"><link rel="prefetch" href="/assets/js/114.974ed66c.js"><link rel="prefetch" href="/assets/js/115.cc476ecf.js"><link rel="prefetch" href="/assets/js/116.cbbb0ff2.js"><link rel="prefetch" href="/assets/js/117.0d09905a.js"><link rel="prefetch" href="/assets/js/118.bed761fe.js"><link rel="prefetch" href="/assets/js/119.00558bbb.js"><link rel="prefetch" href="/assets/js/12.11eefcd9.js"><link rel="prefetch" href="/assets/js/120.599f5d6b.js"><link rel="prefetch" href="/assets/js/121.3314d5f3.js"><link rel="prefetch" href="/assets/js/122.f4ec8581.js"><link rel="prefetch" href="/assets/js/123.4f83939c.js"><link rel="prefetch" href="/assets/js/124.5aecb878.js"><link rel="prefetch" href="/assets/js/125.39f9033e.js"><link rel="prefetch" href="/assets/js/126.b04d084f.js"><link rel="prefetch" href="/assets/js/127.ec3055e2.js"><link rel="prefetch" href="/assets/js/128.81824538.js"><link rel="prefetch" href="/assets/js/129.19dd8429.js"><link rel="prefetch" href="/assets/js/13.727870e3.js"><link rel="prefetch" href="/assets/js/130.cdada4bb.js"><link rel="prefetch" href="/assets/js/131.0beb9709.js"><link rel="prefetch" href="/assets/js/132.11d22220.js"><link rel="prefetch" href="/assets/js/133.15026de0.js"><link rel="prefetch" href="/assets/js/134.82492930.js"><link rel="prefetch" href="/assets/js/135.8a0516c3.js"><link rel="prefetch" href="/assets/js/136.50da2017.js"><link rel="prefetch" href="/assets/js/137.a30c2be2.js"><link rel="prefetch" href="/assets/js/138.f78af822.js"><link rel="prefetch" href="/assets/js/139.71df7032.js"><link rel="prefetch" href="/assets/js/14.e9f14609.js"><link rel="prefetch" href="/assets/js/140.891358ba.js"><link rel="prefetch" href="/assets/js/141.485bdbe9.js"><link rel="prefetch" href="/assets/js/142.cbd5cf73.js"><link rel="prefetch" href="/assets/js/143.f6dc016a.js"><link rel="prefetch" href="/assets/js/144.f33d2461.js"><link rel="prefetch" href="/assets/js/145.14e6b83f.js"><link rel="prefetch" href="/assets/js/146.99477510.js"><link rel="prefetch" href="/assets/js/15.89c2d571.js"><link rel="prefetch" href="/assets/js/16.2208f2ca.js"><link rel="prefetch" href="/assets/js/17.5799c1f8.js"><link rel="prefetch" href="/assets/js/18.928bd560.js"><link rel="prefetch" href="/assets/js/19.8710253f.js"><link rel="prefetch" href="/assets/js/2.619d9f94.js"><link rel="prefetch" href="/assets/js/20.8dfd664a.js"><link rel="prefetch" href="/assets/js/21.e24122e5.js"><link rel="prefetch" href="/assets/js/22.77bcca1f.js"><link rel="prefetch" href="/assets/js/23.c080ea17.js"><link rel="prefetch" href="/assets/js/24.18352236.js"><link rel="prefetch" href="/assets/js/25.684e26b6.js"><link rel="prefetch" href="/assets/js/26.ff83a47d.js"><link rel="prefetch" href="/assets/js/27.41c88d23.js"><link rel="prefetch" href="/assets/js/28.fa030b16.js"><link rel="prefetch" href="/assets/js/29.909ba7e0.js"><link rel="prefetch" href="/assets/js/3.eac51481.js"><link rel="prefetch" href="/assets/js/30.1b8328f7.js"><link rel="prefetch" href="/assets/js/31.6bf4d498.js"><link rel="prefetch" href="/assets/js/32.aef4457c.js"><link rel="prefetch" href="/assets/js/33.d4e930a7.js"><link rel="prefetch" href="/assets/js/34.18a38a89.js"><link rel="prefetch" href="/assets/js/35.953a8f89.js"><link rel="prefetch" href="/assets/js/36.2fccb806.js"><link rel="prefetch" href="/assets/js/37.056c3a61.js"><link rel="prefetch" href="/assets/js/38.0c26ea34.js"><link rel="prefetch" href="/assets/js/39.fb39d5a6.js"><link rel="prefetch" href="/assets/js/4.bae3a048.js"><link rel="prefetch" href="/assets/js/40.d26192b8.js"><link rel="prefetch" href="/assets/js/41.443086b3.js"><link rel="prefetch" href="/assets/js/42.19196aa5.js"><link rel="prefetch" href="/assets/js/43.3bc85c81.js"><link rel="prefetch" href="/assets/js/44.853896aa.js"><link rel="prefetch" href="/assets/js/45.ba20af0a.js"><link rel="prefetch" href="/assets/js/46.d881b154.js"><link rel="prefetch" href="/assets/js/47.4dd20bb8.js"><link rel="prefetch" href="/assets/js/48.defd07fb.js"><link rel="prefetch" href="/assets/js/49.36302155.js"><link rel="prefetch" href="/assets/js/5.8ff5fbd0.js"><link rel="prefetch" href="/assets/js/50.b4fb92f8.js"><link rel="prefetch" href="/assets/js/51.6bb28eec.js"><link rel="prefetch" href="/assets/js/52.c74c78cb.js"><link rel="prefetch" href="/assets/js/53.6bd5b0e5.js"><link rel="prefetch" href="/assets/js/54.96348b32.js"><link rel="prefetch" href="/assets/js/55.d5097965.js"><link rel="prefetch" href="/assets/js/56.2c92071c.js"><link rel="prefetch" href="/assets/js/57.7f18e9fb.js"><link rel="prefetch" href="/assets/js/58.65ed94be.js"><link rel="prefetch" href="/assets/js/59.7ca96399.js"><link rel="prefetch" href="/assets/js/6.52d35211.js"><link rel="prefetch" href="/assets/js/60.eb353ec2.js"><link rel="prefetch" href="/assets/js/61.9d08df0a.js"><link rel="prefetch" href="/assets/js/62.eb4bc347.js"><link rel="prefetch" href="/assets/js/63.323741b6.js"><link rel="prefetch" href="/assets/js/64.d1bf1237.js"><link rel="prefetch" href="/assets/js/65.c7a6c4f2.js"><link rel="prefetch" href="/assets/js/66.b406fbcb.js"><link rel="prefetch" href="/assets/js/67.f3de1f4b.js"><link rel="prefetch" href="/assets/js/68.0986e6ab.js"><link rel="prefetch" href="/assets/js/69.4504ea7d.js"><link rel="prefetch" href="/assets/js/7.55a5412a.js"><link rel="prefetch" href="/assets/js/70.5b2ff894.js"><link rel="prefetch" href="/assets/js/71.5258545b.js"><link rel="prefetch" href="/assets/js/72.93ad883d.js"><link rel="prefetch" href="/assets/js/74.9c5e8120.js"><link rel="prefetch" href="/assets/js/75.88c2ee22.js"><link rel="prefetch" href="/assets/js/76.8ed82020.js"><link rel="prefetch" href="/assets/js/77.d346e0ed.js"><link rel="prefetch" href="/assets/js/78.74ac0303.js"><link rel="prefetch" href="/assets/js/79.3fd30cfc.js"><link rel="prefetch" href="/assets/js/8.942f3372.js"><link rel="prefetch" href="/assets/js/80.fff865f6.js"><link rel="prefetch" href="/assets/js/81.12312749.js"><link rel="prefetch" href="/assets/js/82.519d9454.js"><link rel="prefetch" href="/assets/js/83.b198cdf1.js"><link rel="prefetch" href="/assets/js/84.aa51a346.js"><link rel="prefetch" href="/assets/js/85.4fb38680.js"><link rel="prefetch" href="/assets/js/86.1c76f8a5.js"><link rel="prefetch" href="/assets/js/87.5706ec94.js"><link rel="prefetch" href="/assets/js/88.c20ba8e3.js"><link rel="prefetch" href="/assets/js/89.9ef11b3b.js"><link rel="prefetch" href="/assets/js/9.4377c98a.js"><link rel="prefetch" href="/assets/js/90.0087b4d0.js"><link rel="prefetch" href="/assets/js/91.01f85c23.js"><link rel="prefetch" href="/assets/js/92.7583a50f.js"><link rel="prefetch" href="/assets/js/93.67322b93.js"><link rel="prefetch" href="/assets/js/94.2c48b9f3.js"><link rel="prefetch" href="/assets/js/95.9fd63ed3.js"><link rel="prefetch" href="/assets/js/96.c0539d30.js"><link rel="prefetch" href="/assets/js/97.198524c5.js"><link rel="prefetch" href="/assets/js/98.e35088d8.js"><link rel="prefetch" href="/assets/js/99.ed248232.js">
    <link rel="stylesheet" href="/assets/css/0.styles.522f73f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">vins blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link router-link-active">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link router-link-active">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>层叠图层堆积</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fd/micro-program/skill/cascading-draw.html#辅助函数" class="sidebar-link">辅助函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#px和rpx的转化" class="sidebar-link">px和rpx的转化</a></li><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#canvas画圆角图形" class="sidebar-link">canvas画圆角图形</a></li><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#画布拖动" class="sidebar-link">画布拖动</a></li><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#文件信息" class="sidebar-link">文件信息</a></li><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#canvas生成图片" class="sidebar-link">canvas生成图片</a></li><li class="sidebar-sub-header"><a href="/fd/micro-program/skill/cascading-draw.html#字符串以固定长度分割" class="sidebar-link">字符串以固定长度分割</a></li></ul></li><li><a href="/fd/micro-program/skill/cascading-draw.html#简单封装" class="sidebar-link">简单封装</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="层叠图层堆积"><a href="#层叠图层堆积" aria-hidden="true" class="header-anchor">#</a> 层叠图层堆积</h1> <h2 id="辅助函数"><a href="#辅助函数" aria-hidden="true" class="header-anchor">#</a> 辅助函数</h2> <h3 id="px和rpx的转化"><a href="#px和rpx的转化" aria-hidden="true" class="header-anchor">#</a> px和rpx的转化</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">px2rpx</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> base <span class="token operator">=</span> <span class="token constant">SYS</span><span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">750</span>
  <span class="token keyword">return</span> n <span class="token operator">/</span> base
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> base <span class="token operator">=</span> <span class="token constant">SYS</span><span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">750</span>
  <span class="token keyword">return</span> n <span class="token operator">*</span> base
<span class="token punctuation">}</span>
</code></pre></div><h3 id="canvas画圆角图形"><a href="#canvas画圆角图形" aria-hidden="true" class="header-anchor">#</a> canvas画圆角图形</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// canvas画圆角图形</span>
<span class="token function">drawRoundRect</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> r<span class="token punctuation">,</span> bgColor<span class="token punctuation">,</span> borderColor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>w <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">)</span> r <span class="token operator">=</span> w <span class="token operator">/</span> <span class="token number">2</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">)</span> r <span class="token operator">=</span> h <span class="token operator">/</span> <span class="token number">2</span>
	bgColor <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span><span class="token function">setFillStyle</span><span class="token punctuation">(</span>bgColor<span class="token punctuation">)</span>
	borderColor <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span>borderColor<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>x <span class="token operator">+</span> r<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> w<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	bgColor <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	borderColor <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="画布拖动"><a href="#画布拖动" aria-hidden="true" class="header-anchor">#</a> 画布拖动</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 文本区域触摸</span>
	<span class="token function">canvasTouchStart</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> <span class="token punctuation">{</span> customDrawType<span class="token punctuation">,</span> textAreaLimit <span class="token punctuation">}</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data
		<span class="token keyword">let</span> touchStartObj <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		<span class="token comment">// 点击点在文本框的位置</span>
		touchStartObj<span class="token punctuation">.</span>offsetX <span class="token operator">=</span> touchStartObj<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
		touchStartObj<span class="token punctuation">.</span>offsetY <span class="token operator">=</span> touchStartObj<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>top<span class="token punctuation">)</span>

		<span class="token comment">// 自定义文本区域</span>
		<span class="token keyword">let</span> textArea <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		textArea<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
		textArea<span class="token punctuation">.</span>h <span class="token operator">=</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>height<span class="token punctuation">)</span>

		<span class="token comment">// 判断点击点是否在文本框内</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>touchStartObj<span class="token punctuation">.</span>offsetX <span class="token operator">&lt;</span> <span class="token number">0</span> 
			<span class="token operator">||</span> touchStartObj<span class="token punctuation">.</span>offsetX <span class="token operator">&gt;</span> textArea<span class="token punctuation">.</span>w 
			<span class="token operator">||</span> touchStartObj<span class="token punctuation">.</span>offsetY <span class="token operator">&lt;</span> <span class="token number">0</span> 
			<span class="token operator">||</span> touchStartObj<span class="token punctuation">.</span>offsetY <span class="token operator">&gt;</span> textArea<span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				canDragText<span class="token punctuation">:</span> <span class="token boolean">false</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				canDragText<span class="token punctuation">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 判断是否点击缩放区域</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>touchStartObj<span class="token punctuation">.</span>offsetX <span class="token operator">&lt;</span> textArea<span class="token punctuation">.</span>w <span class="token operator">+</span> textAreaLimit<span class="token punctuation">.</span>dragArea<span class="token punctuation">.</span>w <span class="token operator">/</span> <span class="token number">2</span> 
			<span class="token operator">&amp;&amp;</span> touchStartObj<span class="token punctuation">.</span>offsetY <span class="token operator">&lt;</span> textArea<span class="token punctuation">.</span>h <span class="token operator">+</span> textAreaLimit<span class="token punctuation">.</span>dragArea<span class="token punctuation">.</span>h <span class="token operator">/</span> <span class="token number">2</span> 
			<span class="token operator">&amp;&amp;</span> touchStartObj<span class="token punctuation">.</span>offsetX <span class="token operator">&gt;</span> textArea<span class="token punctuation">.</span>w <span class="token operator">-</span> textAreaLimit<span class="token punctuation">.</span>dragArea<span class="token punctuation">.</span>w <span class="token operator">/</span> <span class="token number">2</span> 
			<span class="token operator">&amp;&amp;</span> touchStartObj<span class="token punctuation">.</span>offsetY <span class="token operator">&gt;</span> textArea<span class="token punctuation">.</span>h <span class="token operator">-</span> textAreaLimit<span class="token punctuation">.</span>dragArea<span class="token punctuation">.</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				canScaleTextArea<span class="token punctuation">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				canScaleTextArea<span class="token punctuation">:</span> <span class="token boolean">false</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			touchStartObj<span class="token punctuation">,</span>
			textAreaObj<span class="token punctuation">:</span> customDrawType
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span><span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">canvasTouchMove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> <span class="token punctuation">{</span> touchStartObj<span class="token punctuation">,</span> canvasObj<span class="token punctuation">,</span> customDrawType<span class="token punctuation">,</span> textAreaObj<span class="token punctuation">,</span> textAreaLimit<span class="token punctuation">,</span> canDragText<span class="token punctuation">,</span> canScaleTextArea <span class="token punctuation">}</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data
		<span class="token keyword">let</span> touchObj <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		<span class="token keyword">let</span> afterTouch <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		afterTouch<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>touchObj<span class="token punctuation">.</span>x <span class="token operator">-</span> touchStartObj<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		afterTouch<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>touchObj<span class="token punctuation">.</span>y <span class="token operator">-</span> touchStartObj<span class="token punctuation">.</span>offsetY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		afterTouch<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>afterTouch<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>canvasobj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>width <span class="token operator">-</span> customDrawType<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span>
		afterTouch<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>afterTouch<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token function">rpx2px</span><span class="token punctuation">(</span>canvasobj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>height <span class="token operator">-</span> customDrawType<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>canDragText <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>canScaleTextArea<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			customDrawType<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">px2rpx</span><span class="token punctuation">(</span>afterTouch<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
			customDrawType<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token function">px2rpx</span><span class="token punctuation">(</span>afterTouch<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
			<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					customDrawType<span class="token punctuation">,</span>
					afterTouch
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				self<span class="token punctuation">.</span><span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>canScaleTextArea<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			customDrawType<span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">px2rpx</span><span class="token punctuation">(</span>touchObj<span class="token punctuation">.</span>x <span class="token operator">-</span> touchStartObj<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> textAreaobj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>width<span class="token punctuation">,</span> textAreaLimit<span class="token punctuation">.</span>minW<span class="token punctuation">)</span>
			customDrawType<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">px2rpx</span><span class="token punctuation">(</span>touchObj<span class="token punctuation">.</span>y <span class="token operator">-</span> touchStartObj<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> textAreaobj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>height<span class="token punctuation">,</span> textAreaLimit<span class="token punctuation">.</span>minH<span class="token punctuation">)</span>

			customDrawType<span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>width<span class="token punctuation">,</span> textAreaLimit<span class="token punctuation">.</span>maxW <span class="token operator">-</span> customDrawType<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
			customDrawType<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>customDrawType<span class="token punctuation">.</span>height<span class="token punctuation">,</span> textAreaLimit<span class="token punctuation">.</span>maxH <span class="token operator">-</span> customDrawType<span class="token punctuation">.</span>top<span class="token punctuation">)</span>
			<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					customDrawType<span class="token punctuation">,</span>
					afterTouch
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				self<span class="token punctuation">.</span><span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">canvasTouchEnd</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		self<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			canScaleTextArea<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			canDragText<span class="token punctuation">:</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span><span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="文件信息"><a href="#文件信息" aria-hidden="true" class="header-anchor">#</a> 文件信息</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 缓存图片信息</span>
<span class="token keyword">const</span> cacheImg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 获取文件信息</span>
<span class="token function">getFileInfo</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> isCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cacheImg<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span>cacheImg<span class="token punctuation">[</span>infoType<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				url<span class="token punctuation">,</span>
				<span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>isCache <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>cacheImg<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							cacheImg<span class="token punctuation">[</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePath
						<span class="token punctuation">}</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
					<span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'获取皮肤失败'</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="canvas生成图片"><a href="#canvas生成图片" aria-hidden="true" class="header-anchor">#</a> canvas生成图片</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 生成临时路径</span>
<span class="token function">canvastoFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		wx<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			fileType<span class="token punctuation">:</span> <span class="token string">'png'</span><span class="token punctuation">,</span>
			quality<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
			canvasId<span class="token punctuation">:</span> <span class="token string">'customCard'</span><span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolveres</span><span class="token punctuation">(</span>tempFilePath<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="字符串以固定长度分割"><a href="#字符串以固定长度分割" aria-hidden="true" class="header-anchor">#</a> 字符串以固定长度分割</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 把字符串以len长度为一组分割，默认长度为1</span>
<span class="token function">strSplitByGroup</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> strMaps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> strArrLen <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> strArrLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> strLen<span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			strMaps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> strMaps
<span class="token punctuation">}</span>
</code></pre></div><h2 id="简单封装"><a href="#简单封装" aria-hidden="true" class="header-anchor">#</a> 简单封装</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> px2rpx<span class="token punctuation">,</span> rpx2px <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./util.js'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token constant">SYS</span> <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> self

<span class="token comment">// 画布信息</span>
<span class="token keyword">const</span> canvasObj <span class="token operator">=</span> <span class="token punctuation">{</span>  
	width<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
	height<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
	radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
	unit<span class="token punctuation">:</span> <span class="token string">'rpx'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 绘制图层</span>
<span class="token keyword">const</span> drawData <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		type<span class="token punctuation">:</span> <span class="token string">'text'</span>  <span class="token comment">// 绘制类型 text,img,shareApp</span>
		position<span class="token punctuation">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 位置信息</span>
			top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
			height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		imgUrl<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>  <span class="token comment">// 图片地址</span>
		imgStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 图片裁剪的样式</span>
			top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
			height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		text<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 文本</span>
		textStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 文本样式</span>
			color<span class="token punctuation">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span>
			fontSize<span class="token punctuation">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span>
			align<span class="token punctuation">:</span> <span class="token string">'bottom'</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		shapeStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 图形样式</span>
			points<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		unit<span class="token punctuation">:</span> <span class="token string">'rpx'</span><span class="token punctuation">,</span>  <span class="token comment">// 单位 rpx 或者 px</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// 绘制</span>
<span class="token keyword">function</span> <span class="token function">initDraw</span><span class="token punctuation">(</span>canvasId <span class="token punctuation">,</span>saveImg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// let { canvasObj, selectSkin, customDrawType, iptText, ctxTextColor, ctxFontSize, textAreaLimit, canScaleTextArea, canDragText, ctxFontStroke } = self.data</span>

		<span class="token keyword">let</span> pxToRpxRatio <span class="token operator">=</span> <span class="token constant">SYS</span><span class="token punctuation">.</span>screenWidth <span class="token operator">/</span> <span class="token number">750</span>
		<span class="token keyword">let</span> ctxWidth <span class="token operator">=</span> canvasobj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>width
		<span class="token keyword">let</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span>canvasId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

		<span class="token comment">// 以px为单位</span>
		ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>pxToRpxRatio<span class="token punctuation">,</span> pxToRpxRatio<span class="token punctuation">)</span>
		ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> drawData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> text<span class="token punctuation">:</span>
					<span class="token function">drawText</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> drawData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> img<span class="token punctuation">:</span>
					<span class="token function">drawImg</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> drawData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> shape<span class="token punctuation">:</span>
					<span class="token keyword">await</span> <span class="token function">drawShape</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> drawData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">default</span><span class="token punctuation">:</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 绘制文字的方法</span>
<span class="token keyword">function</span> <span class="token function">drawText</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ctx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">setFontSize</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>fontSize<span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">setTextAlign</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>align<span class="token punctuation">)</span>

	<span class="token comment">// 颜色渐变</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>colors <span class="token operator">===</span> <span class="token string">'array'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> cgra <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>top <span class="token operator">+</span> obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>fontSize<span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>length<span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			cgra<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span>c <span class="token operator">/</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>colors<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>colors<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> cgra
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>stroke<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
		ctx<span class="token punctuation">.</span><span class="token function">strokeText</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>text<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>left <span class="token operator">+</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>top<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">setFillStyle</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
		ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>text<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>left <span class="token operator">+</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>top<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 绘制图片的方法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">drawImg</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ctx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFileInfo</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>imgUrl<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>left<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>top<span class="token punctuation">,</span> img<span class="token punctuation">.</span>width<span class="token punctuation">,</span> img<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 绘制形状的方法</span>
<span class="token keyword">function</span> <span class="token function">drawShape</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ctx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">let</span> points <span class="token operator">=</span> obj<span class="token punctuation">.</span>shapeStyle<span class="token punctuation">.</span>points
	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>shapeStyle<span class="token punctuation">.</span>stroke<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>shapeStyle<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">setFillStyle</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>shapeStyle<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> points<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			ctx<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>shapeStyle<span class="token punctuation">.</span>stroke<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.4d681007.js" defer></script><script src="/assets/js/73.e899a1fb.js" defer></script>
  </body>
</html>
