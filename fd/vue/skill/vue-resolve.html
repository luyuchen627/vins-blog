<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue组件的解析过程 | vins blog</title>
    <meta name="description" content="vins-blog">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.522f73f5.css" as="style"><link rel="preload" href="/assets/js/app.4d681007.js" as="script"><link rel="preload" href="/assets/js/95.9fd63ed3.js" as="script"><link rel="prefetch" href="/assets/js/10.6c92f68c.js"><link rel="prefetch" href="/assets/js/100.8af1db53.js"><link rel="prefetch" href="/assets/js/101.a8f212fb.js"><link rel="prefetch" href="/assets/js/102.271e20bf.js"><link rel="prefetch" href="/assets/js/103.4dbd4c71.js"><link rel="prefetch" href="/assets/js/104.394031f5.js"><link rel="prefetch" href="/assets/js/105.eaeab38e.js"><link rel="prefetch" href="/assets/js/106.07ccd110.js"><link rel="prefetch" href="/assets/js/107.eb46ec7e.js"><link rel="prefetch" href="/assets/js/108.5c90f70d.js"><link rel="prefetch" href="/assets/js/109.cd44b569.js"><link rel="prefetch" href="/assets/js/11.1c0e0af2.js"><link rel="prefetch" href="/assets/js/110.a57066cd.js"><link rel="prefetch" href="/assets/js/111.252e8880.js"><link rel="prefetch" href="/assets/js/112.193f8246.js"><link rel="prefetch" href="/assets/js/113.9c4918c3.js"><link rel="prefetch" href="/assets/js/114.974ed66c.js"><link rel="prefetch" href="/assets/js/115.cc476ecf.js"><link rel="prefetch" href="/assets/js/116.cbbb0ff2.js"><link rel="prefetch" href="/assets/js/117.0d09905a.js"><link rel="prefetch" href="/assets/js/118.bed761fe.js"><link rel="prefetch" href="/assets/js/119.00558bbb.js"><link rel="prefetch" href="/assets/js/12.11eefcd9.js"><link rel="prefetch" href="/assets/js/120.599f5d6b.js"><link rel="prefetch" href="/assets/js/121.3314d5f3.js"><link rel="prefetch" href="/assets/js/122.f4ec8581.js"><link rel="prefetch" href="/assets/js/123.4f83939c.js"><link rel="prefetch" href="/assets/js/124.5aecb878.js"><link rel="prefetch" href="/assets/js/125.39f9033e.js"><link rel="prefetch" href="/assets/js/126.b04d084f.js"><link rel="prefetch" href="/assets/js/127.ec3055e2.js"><link rel="prefetch" href="/assets/js/128.81824538.js"><link rel="prefetch" href="/assets/js/129.19dd8429.js"><link rel="prefetch" href="/assets/js/13.727870e3.js"><link rel="prefetch" href="/assets/js/130.cdada4bb.js"><link rel="prefetch" href="/assets/js/131.0beb9709.js"><link rel="prefetch" href="/assets/js/132.11d22220.js"><link rel="prefetch" href="/assets/js/133.15026de0.js"><link rel="prefetch" href="/assets/js/134.82492930.js"><link rel="prefetch" href="/assets/js/135.8a0516c3.js"><link rel="prefetch" href="/assets/js/136.50da2017.js"><link rel="prefetch" href="/assets/js/137.a30c2be2.js"><link rel="prefetch" href="/assets/js/138.f78af822.js"><link rel="prefetch" href="/assets/js/139.71df7032.js"><link rel="prefetch" href="/assets/js/14.e9f14609.js"><link rel="prefetch" href="/assets/js/140.891358ba.js"><link rel="prefetch" href="/assets/js/141.485bdbe9.js"><link rel="prefetch" href="/assets/js/142.cbd5cf73.js"><link rel="prefetch" href="/assets/js/143.f6dc016a.js"><link rel="prefetch" href="/assets/js/144.f33d2461.js"><link rel="prefetch" href="/assets/js/145.14e6b83f.js"><link rel="prefetch" href="/assets/js/146.99477510.js"><link rel="prefetch" href="/assets/js/15.89c2d571.js"><link rel="prefetch" href="/assets/js/16.2208f2ca.js"><link rel="prefetch" href="/assets/js/17.5799c1f8.js"><link rel="prefetch" href="/assets/js/18.928bd560.js"><link rel="prefetch" href="/assets/js/19.8710253f.js"><link rel="prefetch" href="/assets/js/2.619d9f94.js"><link rel="prefetch" href="/assets/js/20.8dfd664a.js"><link rel="prefetch" href="/assets/js/21.e24122e5.js"><link rel="prefetch" href="/assets/js/22.77bcca1f.js"><link rel="prefetch" href="/assets/js/23.c080ea17.js"><link rel="prefetch" href="/assets/js/24.18352236.js"><link rel="prefetch" href="/assets/js/25.684e26b6.js"><link rel="prefetch" href="/assets/js/26.ff83a47d.js"><link rel="prefetch" href="/assets/js/27.41c88d23.js"><link rel="prefetch" href="/assets/js/28.fa030b16.js"><link rel="prefetch" href="/assets/js/29.909ba7e0.js"><link rel="prefetch" href="/assets/js/3.eac51481.js"><link rel="prefetch" href="/assets/js/30.1b8328f7.js"><link rel="prefetch" href="/assets/js/31.6bf4d498.js"><link rel="prefetch" href="/assets/js/32.aef4457c.js"><link rel="prefetch" href="/assets/js/33.d4e930a7.js"><link rel="prefetch" href="/assets/js/34.18a38a89.js"><link rel="prefetch" href="/assets/js/35.953a8f89.js"><link rel="prefetch" href="/assets/js/36.2fccb806.js"><link rel="prefetch" href="/assets/js/37.056c3a61.js"><link rel="prefetch" href="/assets/js/38.0c26ea34.js"><link rel="prefetch" href="/assets/js/39.fb39d5a6.js"><link rel="prefetch" href="/assets/js/4.bae3a048.js"><link rel="prefetch" href="/assets/js/40.d26192b8.js"><link rel="prefetch" href="/assets/js/41.443086b3.js"><link rel="prefetch" href="/assets/js/42.19196aa5.js"><link rel="prefetch" href="/assets/js/43.3bc85c81.js"><link rel="prefetch" href="/assets/js/44.853896aa.js"><link rel="prefetch" href="/assets/js/45.ba20af0a.js"><link rel="prefetch" href="/assets/js/46.d881b154.js"><link rel="prefetch" href="/assets/js/47.4dd20bb8.js"><link rel="prefetch" href="/assets/js/48.defd07fb.js"><link rel="prefetch" href="/assets/js/49.36302155.js"><link rel="prefetch" href="/assets/js/5.8ff5fbd0.js"><link rel="prefetch" href="/assets/js/50.b4fb92f8.js"><link rel="prefetch" href="/assets/js/51.6bb28eec.js"><link rel="prefetch" href="/assets/js/52.c74c78cb.js"><link rel="prefetch" href="/assets/js/53.6bd5b0e5.js"><link rel="prefetch" href="/assets/js/54.96348b32.js"><link rel="prefetch" href="/assets/js/55.d5097965.js"><link rel="prefetch" href="/assets/js/56.2c92071c.js"><link rel="prefetch" href="/assets/js/57.7f18e9fb.js"><link rel="prefetch" href="/assets/js/58.65ed94be.js"><link rel="prefetch" href="/assets/js/59.7ca96399.js"><link rel="prefetch" href="/assets/js/6.52d35211.js"><link rel="prefetch" href="/assets/js/60.eb353ec2.js"><link rel="prefetch" href="/assets/js/61.9d08df0a.js"><link rel="prefetch" href="/assets/js/62.eb4bc347.js"><link rel="prefetch" href="/assets/js/63.323741b6.js"><link rel="prefetch" href="/assets/js/64.d1bf1237.js"><link rel="prefetch" href="/assets/js/65.c7a6c4f2.js"><link rel="prefetch" href="/assets/js/66.b406fbcb.js"><link rel="prefetch" href="/assets/js/67.f3de1f4b.js"><link rel="prefetch" href="/assets/js/68.0986e6ab.js"><link rel="prefetch" href="/assets/js/69.4504ea7d.js"><link rel="prefetch" href="/assets/js/7.55a5412a.js"><link rel="prefetch" href="/assets/js/70.5b2ff894.js"><link rel="prefetch" href="/assets/js/71.5258545b.js"><link rel="prefetch" href="/assets/js/72.93ad883d.js"><link rel="prefetch" href="/assets/js/73.e899a1fb.js"><link rel="prefetch" href="/assets/js/74.9c5e8120.js"><link rel="prefetch" href="/assets/js/75.88c2ee22.js"><link rel="prefetch" href="/assets/js/76.8ed82020.js"><link rel="prefetch" href="/assets/js/77.d346e0ed.js"><link rel="prefetch" href="/assets/js/78.74ac0303.js"><link rel="prefetch" href="/assets/js/79.3fd30cfc.js"><link rel="prefetch" href="/assets/js/8.942f3372.js"><link rel="prefetch" href="/assets/js/80.fff865f6.js"><link rel="prefetch" href="/assets/js/81.12312749.js"><link rel="prefetch" href="/assets/js/82.519d9454.js"><link rel="prefetch" href="/assets/js/83.b198cdf1.js"><link rel="prefetch" href="/assets/js/84.aa51a346.js"><link rel="prefetch" href="/assets/js/85.4fb38680.js"><link rel="prefetch" href="/assets/js/86.1c76f8a5.js"><link rel="prefetch" href="/assets/js/87.5706ec94.js"><link rel="prefetch" href="/assets/js/88.c20ba8e3.js"><link rel="prefetch" href="/assets/js/89.9ef11b3b.js"><link rel="prefetch" href="/assets/js/9.4377c98a.js"><link rel="prefetch" href="/assets/js/90.0087b4d0.js"><link rel="prefetch" href="/assets/js/91.01f85c23.js"><link rel="prefetch" href="/assets/js/92.7583a50f.js"><link rel="prefetch" href="/assets/js/93.67322b93.js"><link rel="prefetch" href="/assets/js/94.2c48b9f3.js"><link rel="prefetch" href="/assets/js/96.c0539d30.js"><link rel="prefetch" href="/assets/js/97.198524c5.js"><link rel="prefetch" href="/assets/js/98.e35088d8.js"><link rel="prefetch" href="/assets/js/99.ed248232.js">
    <link rel="stylesheet" href="/assets/css/0.styles.522f73f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">vins blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link router-link-active">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link router-link-active">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>vue组件的解析过程</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fd/vue/skill/vue-resolve.html#实例化" class="sidebar-link">实例化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#核心扩展" class="sidebar-link">核心扩展</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#平台化（web）" class="sidebar-link">平台化（web）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#完整版" class="sidebar-link">完整版</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#重要方法" class="sidebar-link">重要方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#init方法" class="sidebar-link">_init方法</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#definereactive方法" class="sidebar-link">defineReactive方法</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#observe" class="sidebar-link">observe</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#mount" class="sidebar-link">$mount</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#nexttick" class="sidebar-link">$nextTick</a></li></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#核心概念" class="sidebar-link">核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#选项合并" class="sidebar-link">选项合并</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#初始化state" class="sidebar-link">初始化state</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#vnode" class="sidebar-link">Vnode</a></li></ul></li><li><a href="/fd/vue/skill/vue-resolve.html#隐藏的小功能" class="sidebar-link">隐藏的小功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#生命周期函数数组" class="sidebar-link">生命周期函数数组</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#抽象组件" class="sidebar-link">抽象组件</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#指定-parent" class="sidebar-link">指定 parent</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#createelement" class="sidebar-link">$createElement</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#生命周期钩子的事件侦听器" class="sidebar-link">生命周期钩子的事件侦听器</a></li><li class="sidebar-sub-header"><a href="/fd/vue/skill/vue-resolve.html#props-初始化-data" class="sidebar-link">props 初始化 data</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue组件的解析过程"><a href="#vue组件的解析过程" aria-hidden="true" class="header-anchor">#</a> vue组件的解析过程</h1> <p>该系列为 <a href="http://hcysun.me/vue-design/art/" target="_blank" rel="noopener noreferrer">vue技术揭幕<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的简化版本</p> <p><a href="/fd/vue/skill/#实例化">实例化</a> -&gt; <a href="./%E6%A0%B8%E5%BF%83%E6%89%A9%E5%B1%95">核心扩展</a> -&gt; <a href="./%E5%B9%B3%E5%8F%B0%E5%8C%96">平台化-运行时</a> -&gt; <a href="./%E5%AE%8C%E6%95%B4%E7%89%88">完整版</a></p> <h2 id="实例化"><a href="#实例化" aria-hidden="true" class="header-anchor">#</a> 实例化</h2> <p>通过注入Vue的方式扩展 <strong>Vue.prototype</strong></p> <ol><li><p>调用 <strong>initMixin(Vue)</strong> 添加 <a href="./_init%E6%96%B9%E6%B3%95">_init</a></p></li> <li><p>调用 <strong>stateMixin(Vue)</strong></p> <ul><li>代理只读属性 <strong>$data</strong> 到 <strong>this._data</strong></li> <li>代理只读属性  <strong>$props</strong> 到 <strong>this_props</strong></li> <li>添加 <strong>$set</strong>，<strong>$delete</strong> 和 <strong>$watch</strong> 函数</li></ul></li> <li><p>调用 <strong>eventsMixin(Vue)</strong>，添加 <strong>&amp;on</strong>，<strong>&amp;once</strong>，<strong>&amp;off</strong>，<strong>&amp;emit</strong> 方法</p></li> <li><p>调用 <strong>lifecycleMixin(Vue)</strong> 添加 <strong>_update</strong>，<strong>$forceUpdate</strong>，<strong>$destroy</strong> 方法</p></li> <li><p>调用 <strong>renderMixin(Vue)</strong> 添加 <strong>$nextTick</strong>，<strong>_render</strong> 以及和渲染相关的函数</p></li></ol> <h2 id="核心扩展"><a href="#核心扩展" aria-hidden="true" class="header-anchor">#</a> 核心扩展</h2> <ol><li><p>调用 <strong>initGlobalAPI(Vue)</strong> 添加全局函数</p> <ol><li><p>在类上代理只读属性 <strong>config</strong> 到默认的config</p></li> <li><p>在类上添加 <strong>util</strong> 属性</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>util <span class="token operator">=</span> <span class="token punctuation">{</span>
	warn<span class="token punctuation">,</span>
	extend<span class="token punctuation">,</span>
	mergeOptions<span class="token punctuation">,</span>
	defineReactive
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>在类上添加 <strong>set</strong> ，<strong>delete</strong> ，<strong>nextTick</strong> 以及 <strong>options</strong>，options 属性来自 <strong>ASSET_TYPES</strong></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 默认都是空对象，会在不同的平台相应的扩展</span>
Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>
	components<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	directives<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	filters<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	_base<span class="token punctuation">:</span> Vue
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li><p>扩展 <strong>options.components</strong>， 添加非核心组件 <strong>KeepAlive</strong></p></li> <li><p>调用 <strong>initUse(Vue)</strong>，给 <strong>Vue</strong> 添加全局 <strong>use</strong> 方法，加载插件</p></li> <li><p>调用 <strong>initMixin(Vue)</strong>，给 <strong>Vue</strong> 添加全局 <strong>mixin</strong> 方法，注入混合</p></li> <li><p>调用 <strong>initExtend(Vue)</strong>，给 <strong>Vue</strong> 添加全局 <strong>extend</strong> 方法，继承</p></li> <li><p>调用 <strong>initAssetRegisters(Vue)</strong>，添加全局的 <strong>component</strong>，<strong>directive</strong>，<strong>filter</strong>，扩展</p></li></ol></li> <li><p>添加 <strong>$isServer</strong> 是否是服务端渲染的标识</p></li> <li><p>添加 <strong>$ssrContext</strong> 服务端渲染的 Vnode</p></li> <li><p>在类上添加 <strong>FunctionalRenderContext</strong> 组件渲染方法</p></li> <li><p>在类上添加版本号 <strong>version</strong></p></li></ol> <h2 id="平台化（web）"><a href="#平台化（web）" aria-hidden="true" class="header-anchor">#</a> 平台化（web）</h2> <ol><li><p>添加平台化的 <strong>config</strong> 属性</p></li> <li><p>扩展 <strong>options.components</strong> 和 <strong>options.directives</strong>，扩展后的结构</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>
	components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		KeepAlive<span class="token punctuation">,</span>
		Transition<span class="token punctuation">,</span>
		TransitionGroup
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		model<span class="token punctuation">,</span>
		show
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	filters<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	_base<span class="token punctuation">:</span> Vue
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li><p>添加 <strong><code>__patch__</code></strong> 方法</p></li> <li><p>添加 <strong>$mount</strong> 方法</p></li></ol> <h2 id="完整版"><a href="#完整版" aria-hidden="true" class="header-anchor">#</a> 完整版</h2> <ol><li><p>重写 <strong>Vue.prototype.$mount</strong></p></li> <li><p>添加了 <strong>Vue.compile</strong> 全局API</p></li></ol> <h2 id="重要方法"><a href="#重要方法" aria-hidden="true" class="header-anchor">#</a> 重要方法</h2> <h3 id="init方法"><a href="#init方法" aria-hidden="true" class="header-anchor">#</a> _init方法</h3> <ol><li><p>添加 <strong>_isVue</strong> 标识，防止被相应系统观测</p></li> <li><p>将 <a href="/fd/vue/skill/#选项合并">选项合并</a> 的结果添加到新属性 <strong>$options</strong></p></li> <li><p>执行一系列 <em>init*</em> 方法</p> <ol><li><p>调用 <strong>initProxy(vm)</strong> 添加拦截器 <strong>vm._renderProxy</strong>，更好的错误提示</p></li> <li><p>添加 <strong>vm._self = vm</strong>，调用 <strong>initLifecycle(vm)</strong></p> <ul><li><p>把当前实例添加到父实例的 <strong>$children</strong> 数组里</p></li> <li><p>添加 <strong>$parent</strong> 指向父实例</p></li> <li><p>添加 <strong>$root</strong> 指向根元素</p></li> <li><p>添加一些属性</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span>$children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
vm<span class="token punctuation">.</span>$refs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">null</span>
vm<span class="token punctuation">.</span>_inactive <span class="token operator">=</span> <span class="token keyword">null</span>
vm<span class="token punctuation">.</span>_directInactive <span class="token operator">=</span> <span class="token boolean">false</span>
vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">false</span>
vm<span class="token punctuation">.</span>_isDestroyed <span class="token operator">=</span> <span class="token boolean">false</span>
vm<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">=</span> <span class="token boolean">false</span>
</code></pre></div></li> <li><p>调用 <strong>initEvents(vm)</strong> 更新组件的事件</p></li> <li><p>调用 <strong>initRender(vm)</strong> 添加渲染虚拟DOM所使用的一些属性，<a href="/fd/vue/skill/#渲染虚拟节点">渲染虚拟节点</a></p></li> <li><p>调用 <strong>callHook(vm, 'beforeCreate')</strong>，触发 <strong>beforeCreate</strong> 函数</p></li> <li><p>调用 <strong>initInjections(vm)</strong> 初始化 <strong>inject</strong>，遍历所有祖先的**_provided**，合并，使用 <strong>defineReactive</strong> 拦截，并和<strong>data</strong> 一样代理到<strong>vm</strong>，注意，注入的数据不一定是响应式的</p></li> <li><p>调用 <strong>initState(vm)</strong> <a href="/fd/vue/skill/#初始化state">初始化state</a>，包括 <strong>props</strong>，<strong>methods</strong>，<strong>data</strong>，<strong>computed</strong>，<strong>watch</strong></p></li> <li><p>调用 <strong>initProvide(vm)</strong> 初始化 <strong>provide</strong>，添加 <strong>vm._provided</strong></p></li> <li><p>调用 <strong>callHook(vm, 'created')</strong> ，触发 <strong>created</strong> 函数</p></li> <li><p>调用 <strong>$mount()</strong> 方法装载到dom中</p></li></ol></li></ol> <h3 id="definereactive方法"><a href="#definereactive方法" aria-hidden="true" class="header-anchor">#</a> defineReactive方法</h3> <p>在 <strong>getter</strong> 访问器中收集依赖，同时收集在该对象的 <strong><strong>ob</strong></strong> 中，在 <strong>setter</strong> 访问器中通知依赖更新</p> <h3 id="observe"><a href="#observe" aria-hidden="true" class="header-anchor">#</a> observe</h3> <p><strong>observe</strong> 函数用来把数据变为响应数据，该函数会为数据添加 <strong><strong>ob</strong></strong> 属性，用来保存响应依赖，同时通过闭包引用一个 <strong>dep</strong> 对象，通过 <strong>defineReactive</strong> 方法定义数据的访问器，把数据变为响应式，递归 <strong>observe</strong></p> <h3 id="mount"><a href="#mount" aria-hidden="true" class="header-anchor">#</a> $mount</h3> <p><strong>$mount</strong> 函数要做的核心事情就是编译模板 <strong>template</strong> 字符串为渲染函数，并将渲染函数赋值给 <strong>vm.$options.render</strong> 选项，这个选项将会在真正挂载组件的 mountComponent 函数中，渲染函数的顺序是：render &gt; template &gt; el</p> <p>通过内部的 <strong>_render</strong> 渲染虚拟dom，然后 <strong>_update</strong> 把虚拟节点添加到dom中，中间经历着 <strong>依赖收集</strong>，<strong>patch</strong> 补丁，渲染函数的观察(添加 <strong>beforeUpdate</strong>)，异步队列更新</p> <h3 id="nexttick"><a href="#nexttick" aria-hidden="true" class="header-anchor">#</a> $nextTick</h3> <p><strong>$nextTick</strong> 的任务触发优先级：Promise.resolve &gt; setImmediate &gt; MessageChannel &gt; setTimeout</p> <h2 id="核心概念"><a href="#核心概念" aria-hidden="true" class="header-anchor">#</a> 核心概念</h2> <h3 id="选项合并"><a href="#选项合并" aria-hidden="true" class="header-anchor">#</a> 选项合并</h3> <p>将 Vue，及其原型链上的option属性和实例化vue的选项以及该vue实例vm，进行合并</p> <div class="language- extra-class"><pre class="language-text"><code>vm.$options = mergeOptions(
    resolveConstructorOptions(vm.constructor),  // 递归调用 mergeOptions
    options || {},
    vm  // 如果有vm，则为通过 new 创建的实例，否则认为子组件(vue.extend)
)
</code></pre></div><ol><li><p>检查选项的规范性</p> <p>检测components的命名，规范化 <strong>props</strong>，<strong>inject</strong>，<strong>directives</strong>，均格式化为对象，<strong>inject</strong> 格式化为含有一个 <strong>from</strong> 属性的对象</p></li> <li><p>合并</p></li></ol> <p>合并策略 <strong>Vue.config.optionMergeStrategies</strong></p> <ol><li><p><strong>el</strong> 和 <strong>propsData</strong> 使用默认策略</p></li> <li><p><strong>data</strong> 合并为一个函数，<strong>参数为当前实例</strong>，在初始化的时候被调用，调用返回合并后的对象</p></li> <li><p>生命周期合并为一个函数数组，父元素在前，子元素在后的顺序</p></li> <li><p>资源(<strong>directives</strong>、<strong>filters</strong> 和 <strong>components</strong>)的合并，是以原型的方式(<strong>Object.create(parentVal || null)</strong>)合并， **<code>__proto__</code>**指向父元素选项</p></li> <li><p><strong>watch</strong> 选项的合并，父元素有相同的选项时，合并为数组，否则返回 parent || child</p></li> <li><p>props、methods、inject、computed 的合并，父子合并，有相同的选项，子覆盖父</p></li> <li><p><strong>provide</strong> 的合并和 <strong>data</strong> 一样</p></li></ol> <p>默认策略</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">defaultStrat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>parentVal<span class="token punctuation">:</span> any<span class="token punctuation">,</span> childVal<span class="token punctuation">:</span> any<span class="token punctuation">)</span><span class="token punctuation">:</span> any <span class="token punctuation">{</span>
	<span class="token keyword">return</span> childVal <span class="token operator">===</span> undefined
		<span class="token operator">?</span> parentVal
		<span class="token punctuation">:</span> childVal
<span class="token punctuation">}</span>
</code></pre></div><h3 id="初始化state"><a href="#初始化state" aria-hidden="true" class="header-anchor">#</a> 初始化state</h3> <ul><li><p>根据 vm.$options.data 选项获取真正想要的数据（注意：此时 vm.$options.data 是函数）</p></li> <li><p>校验得到的数据是否是一个纯对象</p></li> <li><p>检查数据对象 data 上的键是否与 props 对象上的键冲突</p></li> <li><p>检查 methods 对象上的键是否与 data 对象上的键冲突</p></li> <li><p>在 Vue 实例对象上添加代理访问数据对象的同名属性， 使用 <strong>Object.defineProperty</strong> 代理 <strong>_data</strong> 到 <strong>vm</strong>, 因此 vm.a == vm._data.a</p></li> <li><p>最后调用 <a href="/fd/vue/skill/#observe">observe</a> 函数开启响应式之路</p></li></ul> <h3 id="vnode"><a href="#vnode" aria-hidden="true" class="header-anchor">#</a> Vnode</h3> <p>vue的diff算法用来解析vue实例为虚拟Dom</p> <ol><li><p>匹配字符串中的标签和属性，使用栈保存dom的父子关系</p></li> <li><p>通过注入的钩子函数，处理响应的标签和属性</p></li></ol> <p><a href="https://segmentfault.com/a/1190000008782928" target="_blank" rel="noopener noreferrer">vue的diff算法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="隐藏的小功能"><a href="#隐藏的小功能" aria-hidden="true" class="header-anchor">#</a> 隐藏的小功能</h2> <h3 id="生命周期函数数组"><a href="#生命周期函数数组" aria-hidden="true" class="header-anchor">#</a> 生命周期函数数组</h3> <p>生命周期函数可以定义为一个函数数组</p> <h3 id="抽象组件"><a href="#抽象组件" aria-hidden="true" class="header-anchor">#</a> 抽象组件</h3> <p>在 <strong>option</strong> 上添加 <strong>abstract: true</strong>，抽象组件的特点就是它们不渲染真实DOM，而且不会出现在父子关系的路径</p> <p>例如 <strong>keep-alive</strong> 和 <strong>transition</strong> 就是抽象组件</p> <h3 id="指定-parent"><a href="#指定-parent" aria-hidden="true" class="header-anchor">#</a> 指定 parent</h3> <p>在定义子组件的时候可以指定 <strong>parent</strong></p> <h3 id="createelement"><a href="#createelement" aria-hidden="true" class="header-anchor">#</a> $createElement</h3> <p>可是使用 <strong>$createElement</strong> 创建元素</p> <h3 id="生命周期钩子的事件侦听器"><a href="#生命周期钩子的事件侦听器" aria-hidden="true" class="header-anchor">#</a> 生命周期钩子的事件侦听器</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span>
	<span class="token attr-name"><span class="token namespace">@hook:</span>beforeCreate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleChildBeforeCreate<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">@hook:</span>created</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleChildCreated<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">@hook:</span>mounted</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleChildMounted<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">@hook:</span>生命周期钩子</span>
 <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="props-初始化-data"><a href="#props-初始化-data" aria-hidden="true" class="header-anchor">#</a> props 初始化 data</h3> <p>因为props 的初始化再data的前面，所以data可以访问props，但是data中声明的局部变量不随着props更新而更新</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.4d681007.js" defer></script><script src="/assets/js/95.9fd63ed3.js" defer></script>
  </body>
</html>
