<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sequelizejs-CRUD | vins blog</title>
    <meta name="description" content="vins-blog">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.522f73f5.css" as="style"><link rel="preload" href="/assets/js/app.4d681007.js" as="script"><link rel="preload" href="/assets/js/137.a30c2be2.js" as="script"><link rel="prefetch" href="/assets/js/10.6c92f68c.js"><link rel="prefetch" href="/assets/js/100.8af1db53.js"><link rel="prefetch" href="/assets/js/101.a8f212fb.js"><link rel="prefetch" href="/assets/js/102.271e20bf.js"><link rel="prefetch" href="/assets/js/103.4dbd4c71.js"><link rel="prefetch" href="/assets/js/104.394031f5.js"><link rel="prefetch" href="/assets/js/105.eaeab38e.js"><link rel="prefetch" href="/assets/js/106.07ccd110.js"><link rel="prefetch" href="/assets/js/107.eb46ec7e.js"><link rel="prefetch" href="/assets/js/108.5c90f70d.js"><link rel="prefetch" href="/assets/js/109.cd44b569.js"><link rel="prefetch" href="/assets/js/11.1c0e0af2.js"><link rel="prefetch" href="/assets/js/110.a57066cd.js"><link rel="prefetch" href="/assets/js/111.252e8880.js"><link rel="prefetch" href="/assets/js/112.193f8246.js"><link rel="prefetch" href="/assets/js/113.9c4918c3.js"><link rel="prefetch" href="/assets/js/114.974ed66c.js"><link rel="prefetch" href="/assets/js/115.cc476ecf.js"><link rel="prefetch" href="/assets/js/116.cbbb0ff2.js"><link rel="prefetch" href="/assets/js/117.0d09905a.js"><link rel="prefetch" href="/assets/js/118.bed761fe.js"><link rel="prefetch" href="/assets/js/119.00558bbb.js"><link rel="prefetch" href="/assets/js/12.11eefcd9.js"><link rel="prefetch" href="/assets/js/120.599f5d6b.js"><link rel="prefetch" href="/assets/js/121.3314d5f3.js"><link rel="prefetch" href="/assets/js/122.f4ec8581.js"><link rel="prefetch" href="/assets/js/123.4f83939c.js"><link rel="prefetch" href="/assets/js/124.5aecb878.js"><link rel="prefetch" href="/assets/js/125.39f9033e.js"><link rel="prefetch" href="/assets/js/126.b04d084f.js"><link rel="prefetch" href="/assets/js/127.ec3055e2.js"><link rel="prefetch" href="/assets/js/128.81824538.js"><link rel="prefetch" href="/assets/js/129.19dd8429.js"><link rel="prefetch" href="/assets/js/13.727870e3.js"><link rel="prefetch" href="/assets/js/130.cdada4bb.js"><link rel="prefetch" href="/assets/js/131.0beb9709.js"><link rel="prefetch" href="/assets/js/132.11d22220.js"><link rel="prefetch" href="/assets/js/133.15026de0.js"><link rel="prefetch" href="/assets/js/134.82492930.js"><link rel="prefetch" href="/assets/js/135.8a0516c3.js"><link rel="prefetch" href="/assets/js/136.50da2017.js"><link rel="prefetch" href="/assets/js/138.f78af822.js"><link rel="prefetch" href="/assets/js/139.71df7032.js"><link rel="prefetch" href="/assets/js/14.e9f14609.js"><link rel="prefetch" href="/assets/js/140.891358ba.js"><link rel="prefetch" href="/assets/js/141.485bdbe9.js"><link rel="prefetch" href="/assets/js/142.cbd5cf73.js"><link rel="prefetch" href="/assets/js/143.f6dc016a.js"><link rel="prefetch" href="/assets/js/144.f33d2461.js"><link rel="prefetch" href="/assets/js/145.14e6b83f.js"><link rel="prefetch" href="/assets/js/146.99477510.js"><link rel="prefetch" href="/assets/js/15.89c2d571.js"><link rel="prefetch" href="/assets/js/16.2208f2ca.js"><link rel="prefetch" href="/assets/js/17.5799c1f8.js"><link rel="prefetch" href="/assets/js/18.928bd560.js"><link rel="prefetch" href="/assets/js/19.8710253f.js"><link rel="prefetch" href="/assets/js/2.619d9f94.js"><link rel="prefetch" href="/assets/js/20.8dfd664a.js"><link rel="prefetch" href="/assets/js/21.e24122e5.js"><link rel="prefetch" href="/assets/js/22.77bcca1f.js"><link rel="prefetch" href="/assets/js/23.c080ea17.js"><link rel="prefetch" href="/assets/js/24.18352236.js"><link rel="prefetch" href="/assets/js/25.684e26b6.js"><link rel="prefetch" href="/assets/js/26.ff83a47d.js"><link rel="prefetch" href="/assets/js/27.41c88d23.js"><link rel="prefetch" href="/assets/js/28.fa030b16.js"><link rel="prefetch" href="/assets/js/29.909ba7e0.js"><link rel="prefetch" href="/assets/js/3.eac51481.js"><link rel="prefetch" href="/assets/js/30.1b8328f7.js"><link rel="prefetch" href="/assets/js/31.6bf4d498.js"><link rel="prefetch" href="/assets/js/32.aef4457c.js"><link rel="prefetch" href="/assets/js/33.d4e930a7.js"><link rel="prefetch" href="/assets/js/34.18a38a89.js"><link rel="prefetch" href="/assets/js/35.953a8f89.js"><link rel="prefetch" href="/assets/js/36.2fccb806.js"><link rel="prefetch" href="/assets/js/37.056c3a61.js"><link rel="prefetch" href="/assets/js/38.0c26ea34.js"><link rel="prefetch" href="/assets/js/39.fb39d5a6.js"><link rel="prefetch" href="/assets/js/4.bae3a048.js"><link rel="prefetch" href="/assets/js/40.d26192b8.js"><link rel="prefetch" href="/assets/js/41.443086b3.js"><link rel="prefetch" href="/assets/js/42.19196aa5.js"><link rel="prefetch" href="/assets/js/43.3bc85c81.js"><link rel="prefetch" href="/assets/js/44.853896aa.js"><link rel="prefetch" href="/assets/js/45.ba20af0a.js"><link rel="prefetch" href="/assets/js/46.d881b154.js"><link rel="prefetch" href="/assets/js/47.4dd20bb8.js"><link rel="prefetch" href="/assets/js/48.defd07fb.js"><link rel="prefetch" href="/assets/js/49.36302155.js"><link rel="prefetch" href="/assets/js/5.8ff5fbd0.js"><link rel="prefetch" href="/assets/js/50.b4fb92f8.js"><link rel="prefetch" href="/assets/js/51.6bb28eec.js"><link rel="prefetch" href="/assets/js/52.c74c78cb.js"><link rel="prefetch" href="/assets/js/53.6bd5b0e5.js"><link rel="prefetch" href="/assets/js/54.96348b32.js"><link rel="prefetch" href="/assets/js/55.d5097965.js"><link rel="prefetch" href="/assets/js/56.2c92071c.js"><link rel="prefetch" href="/assets/js/57.7f18e9fb.js"><link rel="prefetch" href="/assets/js/58.65ed94be.js"><link rel="prefetch" href="/assets/js/59.7ca96399.js"><link rel="prefetch" href="/assets/js/6.52d35211.js"><link rel="prefetch" href="/assets/js/60.eb353ec2.js"><link rel="prefetch" href="/assets/js/61.9d08df0a.js"><link rel="prefetch" href="/assets/js/62.eb4bc347.js"><link rel="prefetch" href="/assets/js/63.323741b6.js"><link rel="prefetch" href="/assets/js/64.d1bf1237.js"><link rel="prefetch" href="/assets/js/65.c7a6c4f2.js"><link rel="prefetch" href="/assets/js/66.b406fbcb.js"><link rel="prefetch" href="/assets/js/67.f3de1f4b.js"><link rel="prefetch" href="/assets/js/68.0986e6ab.js"><link rel="prefetch" href="/assets/js/69.4504ea7d.js"><link rel="prefetch" href="/assets/js/7.55a5412a.js"><link rel="prefetch" href="/assets/js/70.5b2ff894.js"><link rel="prefetch" href="/assets/js/71.5258545b.js"><link rel="prefetch" href="/assets/js/72.93ad883d.js"><link rel="prefetch" href="/assets/js/73.e899a1fb.js"><link rel="prefetch" href="/assets/js/74.9c5e8120.js"><link rel="prefetch" href="/assets/js/75.88c2ee22.js"><link rel="prefetch" href="/assets/js/76.8ed82020.js"><link rel="prefetch" href="/assets/js/77.d346e0ed.js"><link rel="prefetch" href="/assets/js/78.74ac0303.js"><link rel="prefetch" href="/assets/js/79.3fd30cfc.js"><link rel="prefetch" href="/assets/js/8.942f3372.js"><link rel="prefetch" href="/assets/js/80.fff865f6.js"><link rel="prefetch" href="/assets/js/81.12312749.js"><link rel="prefetch" href="/assets/js/82.519d9454.js"><link rel="prefetch" href="/assets/js/83.b198cdf1.js"><link rel="prefetch" href="/assets/js/84.aa51a346.js"><link rel="prefetch" href="/assets/js/85.4fb38680.js"><link rel="prefetch" href="/assets/js/86.1c76f8a5.js"><link rel="prefetch" href="/assets/js/87.5706ec94.js"><link rel="prefetch" href="/assets/js/88.c20ba8e3.js"><link rel="prefetch" href="/assets/js/89.9ef11b3b.js"><link rel="prefetch" href="/assets/js/9.4377c98a.js"><link rel="prefetch" href="/assets/js/90.0087b4d0.js"><link rel="prefetch" href="/assets/js/91.01f85c23.js"><link rel="prefetch" href="/assets/js/92.7583a50f.js"><link rel="prefetch" href="/assets/js/93.67322b93.js"><link rel="prefetch" href="/assets/js/94.2c48b9f3.js"><link rel="prefetch" href="/assets/js/95.9fd63ed3.js"><link rel="prefetch" href="/assets/js/96.c0539d30.js"><link rel="prefetch" href="/assets/js/97.198524c5.js"><link rel="prefetch" href="/assets/js/98.e35088d8.js"><link rel="prefetch" href="/assets/js/99.ed248232.js">
    <link rel="stylesheet" href="/assets/css/0.styles.522f73f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">vins blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link router-link-active">node</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/fd/" class="nav-link">fd</a></div><div class="nav-item"><a href="/node/" class="nav-link router-link-active">node</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>sequelizejs-CRUD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/node/sql/sequelizejs/crud.html#创建" class="sidebar-link">创建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#创建单例" class="sidebar-link">创建单例</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#批量创建" class="sidebar-link">批量创建</a></li></ul></li><li><a href="/node/sql/sequelizejs/crud.html#更新" class="sidebar-link">更新</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#单例更新" class="sidebar-link">单例更新</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#批量更新" class="sidebar-link">批量更新</a></li></ul></li><li><a href="/node/sql/sequelizejs/crud.html#删除" class="sidebar-link">删除</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#单例删除" class="sidebar-link">单例删除</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#批量删除" class="sidebar-link">批量删除</a></li></ul></li><li><a href="/node/sql/sequelizejs/crud.html#查询" class="sidebar-link">查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#查询方法列表" class="sidebar-link">查询方法列表</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#比较运算符" class="sidebar-link">比较运算符</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#分页" class="sidebar-link">分页</a></li><li class="sidebar-sub-header"><a href="/node/sql/sequelizejs/crud.html#排序" class="sidebar-link">排序</a></li></ul></li><li><a href="/node/sql/sequelizejs/crud.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="sequelizejs-crud"><a href="#sequelizejs-crud" aria-hidden="true" class="header-anchor">#</a> sequelizejs-CRUD</h1> <h2 id="创建"><a href="#创建" aria-hidden="true" class="header-anchor">#</a> 创建</h2> <h3 id="创建单例"><a href="#创建单例" aria-hidden="true" class="header-anchor">#</a> 创建单例</h3> <p>有两种方式可以创建一个实例</p> <ol><li>非持久性实例</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建非持久性实例</span>
Task
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> deadline<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 创建</span>
  <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 保存到数据库</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>anotherTask <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// you can now access the currently saved task with the variable anotherTask... nice!</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ooops, do some error-handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>持久化实例</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建持久化实例</span>
User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">:</span> <span class="token string">'barfooz'</span><span class="token punctuation">,</span> isAdmin<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> fields<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'username'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// let's assume the default of isAdmin is false:</span>
  <span class="token comment">// 使用user.get({ plain: true })获取详细信息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plain<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; { username: 'barfooz', isAdmin: false }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="批量创建"><a href="#批量创建" aria-hidden="true" class="header-anchor">#</a> 批量创建</h3> <p>Model.bulkCreate</p> <h2 id="更新"><a href="#更新" aria-hidden="true" class="header-anchor">#</a> 更新</h2> <h3 id="单例更新"><a href="#单例更新" aria-hidden="true" class="header-anchor">#</a> 单例更新</h3> <p>现在让我们更改一些值并保存对数据库的更改......有两种方法可以做到这一点：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// way 1</span>
task<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'a very different title now'</span>
task<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// way 2</span>
task<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'a very different title now'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> where<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="批量更新"><a href="#批量更新" aria-hidden="true" class="header-anchor">#</a> 批量更新</h3> <p>Model.update</p> <h2 id="删除"><a href="#删除" aria-hidden="true" class="header-anchor">#</a> 删除</h2> <h3 id="单例删除"><a href="#单例删除" aria-hidden="true" class="header-anchor">#</a> 单例删除</h3> <p>创建对象并获得对象的引用后，可以从数据库中删除它。相关方法是destroy：</p> <div class="language-js extra-class"><pre class="language-js"><code>Task<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'a task'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>task <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// now you see me...</span>
  <span class="token keyword">return</span> task<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// now i'm gone :)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果paranoid选项为true，则不会删除该对象，而是将该deletedAt列设置为当前时间戳。要强制删除，您可以传递force: true给destroy调用：</p> <div class="language-js extra-class"><pre class="language-js"><code>task<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="批量删除"><a href="#批量删除" aria-hidden="true" class="header-anchor">#</a> 批量删除</h3> <p>Model.destroy</p> <h2 id="查询"><a href="#查询" aria-hidden="true" class="header-anchor">#</a> 查询</h2> <p>数据检索的所有方法返回的都是一个promise实例，在then方法中可以获取模型实例，<strong>不存在返回为null</strong>，所有的方法命名遵循驼峰格式</p> <h3 id="查询方法列表"><a href="#查询方法列表" aria-hidden="true" class="header-anchor">#</a> 查询方法列表</h3> <h4 id="findbyid-object-null"><a href="#findbyid-object-null" aria-hidden="true" class="header-anchor">#</a> findById =&gt; Object || null</h4> <div class="language-js extra-class"><pre class="language-js"><code>Project<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>project <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  返回id<span class="token operator">=</span><span class="token number">123</span>的记录
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="findone-object-null"><a href="#findone-object-null" aria-hidden="true" class="header-anchor">#</a> findOne =&gt; Object || null</h4> <div class="language-js extra-class"><pre class="language-js"><code>Project<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token punctuation">:</span> <span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">'aProject'</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>project <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回title=aProject的记录</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="findorcreate-object"><a href="#findorcreate-object" aria-hidden="true" class="header-anchor">#</a> findOrCreate =&gt; Object</h4> <p>该方法findOrCreate可用于检查数据库中是否已存在某个元素。如果是这种情况，该方法将导致相应的实例。如果该元素尚不存在，则将创建该元素。</p> <h4 id="findandcountall-count-记录数，rows-记录数组"><a href="#findandcountall-count-记录数，rows-记录数组" aria-hidden="true" class="header-anchor">#</a> findAndCountAll =&gt; { count: 记录数，rows: 记录数组 || [] }</h4> <p>这是结合了方便的方法findAll和count，这与要检索与数据相关的分页查询打交道时是非常有用的limit，并offset还需要知道的匹配查询记录的总数：</p> <p>成功处理程序将始终接收具有两个属性的对象：</p> <ul><li>count - 由于关联而匹配where子句和其他过滤器的整数，总数记录</li> <li>rows - 一个对象数组，与where子句匹配的记录以及由于关联而在限制和偏移范围内的其他过滤器</li></ul> <p>支持连表查询，只有标记为的包含required才会添加到计数部分：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假设您要查找已附加个人资料的所有用户：</span>
User<span class="token punctuation">.</span><span class="token function">findAndCountAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  include<span class="token punctuation">:</span> <span class="token punctuation">[</span>
     <span class="token punctuation">{</span> model<span class="token punctuation">:</span> Profile<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  limit<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="findall-array"><a href="#findall-array" aria-hidden="true" class="header-anchor">#</a> findAll =&gt; Array || []</h4> <p>在数据库中搜索多个元素</p> <h3 id="参数"><a href="#参数" aria-hidden="true" class="header-anchor">#</a> 参数</h3> <h4 id="返回的属性"><a href="#返回的属性" aria-hidden="true" class="header-anchor">#</a> 返回的属性</h4> <ol><li><p>字段选择
要仅选择某些属性，可以使用该attributes选项。通常，您传递一个数组：
attributes: ['foo', 'bar']  &gt;&gt; SELECT foo, bar ...</p></li> <li><p>字段重命名</p></li></ol> <ul><li><p>使用嵌套数据重命名属性
attributes: ['foo', ['a', 'b']]  &gt;&gt; SELECT foo, a AS b ...</p></li> <li><p>聚合函数（必须命名聚合字段）
attributes: [[sequelize.fn('COUNT', sequelize.col('hats')), 'no_hats']]  &gt;&gt; SELECT COUNT(hats) AS no_hats ...</p></li></ul> <ol start="3"><li><p>不包含某些属性
attributes: { exclude: ['baz'] }</p></li> <li><p>关联查询数据合并字段</p></li></ol> <ul><li><strong>内连接</strong> 联表查询时都指定attributes</li> <li><strong>raw:true</strong> 返回会以 <strong>.</strong> 作为连接; eg: 'a.b': 'vins'</li> <li><strong>手动拼接</strong> 使用Sequelize.col('u.userName')选择列名</li></ul> <h4 id="条件筛选"><a href="#条件筛选" aria-hidden="true" class="header-anchor">#</a> 条件筛选</h4> <p>要精确匹配部分数据，可以使用该where选项
具体的参考下文<strong>比较运算符</strong></p> <h4 id="关联查询"><a href="#关联查询" aria-hidden="true" class="header-anchor">#</a> 关联查询</h4> <ol><li><p>当您从数据库中检索数据时，您很可能也希望获得与同一查询的关联 - 这称为预先加载。背后的基本思想，就是利用的属性include
Project.findAll({
include: [{
model: Task,
where: { state: Sequelize.col('project.state') }
}]
})
默认条件为主键和外键的匹配，例如
Admin.belongsTo(AuthGroupAccess, { foreignKey: 'admin_id', targetKey: 'uid' }) =&gt; where Admin.admin_id = AuthGroupAccess.uid</p></li> <li><p>如果关联是别名（使用该as选项），则必须在包含模型时指定此别名
include: [{ model: Tool, as: 'Instruments' }]</p></li> <li><p>要将where条件从包含的模型从ON条件移动到顶级WHERE，可以使用以下'$nested.column$'语法：</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'$Instruments.name$'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>iLike<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">'%ooth%'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        model<span class="token punctuation">:</span> Tool<span class="token punctuation">,</span>
        <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">'Instruments'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><p>如果您想要加载软删除的记录，可以通过设置include.paranoid来实现false</p></li> <li><p>include的使用和嵌套，将使用外链接；
但是，where相关模型上的子句将创建内部联接，并仅返回具有匹配子模型的实例。要返回所有父实例，您应该添加required: false。</p></li></ol> <h3 id="比较运算符"><a href="#比较运算符" aria-hidden="true" class="header-anchor">#</a> 比较运算符</h3> <p>配合构建出复杂的条件查询
位置：const Op = Sequelize.Op</p> <ul><li><p>[Op.and]: {a: 5}           // AND (a = 5)</p></li> <li><p>[Op.or]: [{a: 5}, {a: 6}]  // (a = 5 OR a = 6)</p></li> <li><p>[Op.gt]: 6,                // &gt; 6</p></li> <li><p>[Op.gte]: 6,               // &gt;= 6</p></li> <li><p>[Op.lt]: 10,               // &lt; 10</p></li> <li><p>[Op.lte]: 10,              // &lt;= 10</p></li> <li><p>[Op.ne]: 20,               // != 20</p></li> <li><p>[Op.eq]: 3,                // = 3</p></li> <li><p>[Op.not]: true,            // IS NOT TRUE</p></li> <li><p>[Op.between]: [6, 10],     // BETWEEN 6 AND 10</p></li> <li><p>[Op.notBetween]: [11, 15], // NOT BETWEEN 11 AND 15</p></li> <li><p>[Op.in]: [1, 2],           // IN [1, 2]</p></li> <li><p>[Op.notIn]: [1, 2],        // NOT IN [1, 2]</p></li> <li><p>[Op.like]: '%hat',         // LIKE '%hat'</p></li> <li><p>[Op.notLike]: '%hat'       // NOT LIKE '%hat'</p></li> <li><p>[Op.iLike]: '%hat'         // ILIKE '%hat' (case insensitive) (PG only)</p></li> <li><p>[Op.notILike]: '%hat'      // NOT ILIKE '%hat'  (PG only)</p></li> <li><p>[Op.regexp]: '^[h|a|t]'    // REGEXP/~ '^[h|a|t]' (MySQL/PG only)</p></li> <li><p>[Op.notRegexp]: '^[h|a|t]' // NOT REGEXP/!~ '^[h|a|t]' (MySQL/PG only)</p></li> <li><p>[Op.iRegexp]: '^[h|a|t]'    // ~* '^[h|a|t]' (PG only)</p></li> <li><p>[Op.notIRegexp]: '^[h|a|t]' // !~* '^[h|a|t]' (PG only)</p></li> <li><p>[Op.like]: { [Op.any]: ['cat', 'hat']} // LIKE ANY ARRAY['cat', 'hat'] - also works for iLike and notLike</p></li> <li><p>[Op.overlap]: [1, 2]       // &amp;&amp; [1, 2] (PG array overlap operator)</p></li> <li><p>[Op.contains]: [1, 2]      // @&gt; [1, 2] (PG array contains operator)</p></li> <li><p>[Op.contained]: [1, 2]     // &lt;@ [1, 2] (PG array contained by operator)</p></li> <li><p>[Op.any]: [2,3]            // ANY ARRAY[2, 3]::INTEGER (PG only)</p></li> <li><p>[Op.col]: 'user.organization_id' // = &quot;user&quot;.&quot;organization_id&quot;, with dialect specific column identifiers, PG in this example</p></li> <li><p>[Op.contains]: 2           // @&gt; '2'::integer (PG range contains element operator)</p></li> <li><p>[Op.contains]: [1, 2]      // @&gt; [1, 2) (PG range contains range operator)</p></li> <li><p>[Op.contained]: [1, 2]     // &lt;@ [1, 2) (PG range is contained by operator)</p></li> <li><p>[Op.overlap]: [1, 2]       // &amp;&amp; [1, 2) (PG range overlap (have points in common) operator)</p></li> <li><p>[Op.adjacent]: [1, 2]      // -|- [1, 2) (PG range is adjacent to operator)</p></li> <li><p>[Op.strictLeft]: [1, 2]    // &lt;&lt; [1, 2) (PG range strictly left of operator)</p></li> <li><p>[Op.strictRight]: [1, 2]   // &gt;&gt; [1, 2) (PG range strictly right of operator)</p></li> <li><p>[Op.noExtendRight]: [1, 2] // &amp;&lt; [1, 2) (PG range does not extend to the right of operator)</p></li> <li><p>[Op.noExtendLeft]: [1, 2]  // &amp;&gt; [1, 2) (PG range does not extend to the left of operator)</p></li></ul> <h4 id="运算符别名"><a href="#运算符别名" aria-hidden="true" class="header-anchor">#</a> 运算符别名</h4> <p>Sequelize允许将特定字符串设置为运算符的别名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Op <span class="token operator">=</span> Sequelize<span class="token punctuation">.</span>Op<span class="token punctuation">;</span>
<span class="token keyword">const</span> operatorsAliases <span class="token operator">=</span> <span class="token punctuation">{</span>
  $gt<span class="token punctuation">:</span> Op<span class="token punctuation">.</span>gt
<span class="token punctuation">}</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> user<span class="token punctuation">,</span> pass<span class="token punctuation">,</span> <span class="token punctuation">{</span> operatorsAliases <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span>Op<span class="token punctuation">.</span>gt<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">// &gt; 6</span>
$gt<span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">// same as using Op.gt (&gt; 6)</span>
</code></pre></div><blockquote><p>使用没有任何别名的Sequelize可以提高安全性。一些框架会自动将用户输入解析为js对象，如果您无法清理输入，则可能会将带有字符串运算符的Object注入Sequelize。没有任何字符串别名将使注入运算符的可能性极小,但您应始终正确验证和清理用户输入。</p></blockquote> <h3 id="分页"><a href="#分页" aria-hidden="true" class="header-anchor">#</a> 分页</h3> <ul><li>offset 查找的偏移量</li> <li>limit 查找的数量
Project.findAll({ offset: 5, limit: 5 })</li></ul> <h3 id="排序"><a href="#排序" aria-hidden="true" class="header-anchor">#</a> 排序</h3> <p>order采用一系列项目来订购查询或通过sequelize方法。通常，您将需要使用属性，方法或方法的元组/数组来确保正确转义。</p> <ul><li>订购查询使用二维数组，支持多字段排序</li> <li>ASC 升序</li> <li>DESC 降序</li></ul> <p>order的设置方式：</p> <ul><li>order: [['title', 'DESC']]</li> <li>order：[[sequelize.fn('max', sequelize.col('age')), 'DESC']]</li> <li>order: sequelize.literal('max(age) DESC')</li> <li>order: sequelize.col('age')</li></ul> <p>官网例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>Subtask<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  order<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// Will escape title and validate DESC against a list of valid direction parameters</span>
    <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by max(age)</span>
    sequelize<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'max'</span><span class="token punctuation">,</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by max(age) DESC</span>
    <span class="token punctuation">[</span>sequelize<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'max'</span><span class="token punctuation">,</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by  otherfunction(`col1`, 12, 'lalala') DESC</span>
    <span class="token punctuation">[</span>sequelize<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'otherfunction'</span><span class="token punctuation">,</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">'col1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'lalala'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order an associated model's created_at using the model name as the association's name.</span>
    <span class="token punctuation">[</span>Task<span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order through an associated model's created_at using the model names as the associations' names.</span>
    <span class="token punctuation">[</span>Task<span class="token punctuation">,</span> Project<span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by an associated model's created_at using the name of the association.</span>
    <span class="token punctuation">[</span><span class="token string">'Task'</span><span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by a nested associated model's created_at using the names of the associations.</span>
    <span class="token punctuation">[</span><span class="token string">'Task'</span><span class="token punctuation">,</span> <span class="token string">'Project'</span><span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by an associated model's created_at using an association object. (preferred method)</span>
    <span class="token punctuation">[</span>Subtask<span class="token punctuation">.</span>associations<span class="token punctuation">.</span>Task<span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by a nested associated model's created_at using association objects. (preferred method)</span>
    <span class="token punctuation">[</span>Subtask<span class="token punctuation">.</span>associations<span class="token punctuation">.</span>Task<span class="token punctuation">,</span> Task<span class="token punctuation">.</span>associations<span class="token punctuation">.</span>Project<span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by an associated model's created_at using a simple association object.</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span>model<span class="token punctuation">:</span> Task<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">'Task'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// Will order by a nested associated model's created_at simple association objects.</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span>model<span class="token punctuation">:</span> Task<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">'Task'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>model<span class="token punctuation">:</span> Project<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">'Project'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'createdAt'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>

  <span class="token comment">// Will order by max age descending</span>
  order<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">'max(age) DESC'</span><span class="token punctuation">)</span>

  <span class="token comment">// Will order by max age ascending assuming ascending is the default order when direction is omitted</span>
  order<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'max'</span><span class="token punctuation">,</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// Will order by age ascending assuming ascending is the default order when direction is omitted</span>
  order<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>

  <span class="token comment">// Will order randomly based on the dialect (instead of fn('RAND') or fn('RANDOM'))</span>
  order<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <p><a href="http://docs.sequelizejs.com/manual/tutorial/querying.html" target="_blank" rel="noopener noreferrer">sequelizejs官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.4d681007.js" defer></script><script src="/assets/js/137.a30c2be2.js" defer></script>
  </body>
</html>
